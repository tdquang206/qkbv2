{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Edit Drug {{ drug.drug_name }}</h1>
    <form method="POST" action="{{ request.url_for('edit_drug', drug_id=drug.id) }}" id="drug-form">

        <!-- SKU -->
        <div class="mb-3">
            <label for="drug_sku" class="form-label">SKU</label>
            <input type="text" class="form-control" name="drug_sku" id="drug_sku" value="{{ drug.drug_sku }}" required
                readonly>
        </div>

        <!-- Name -->
        <div class="mb-3">
            <label for="drug_name" class="form-label">Drug Name</label>
            <input type="text" class="form-control" name="drug_name" id="drug_name" value="{{ drug.drug_name }}"
                required>
        </div>

        <!-- Sell Price -->
        <div class="mb-3">
            <label for="drug_sell_price" class="form-label">Sell Price</label>
            <input type="number" step="0.01" class="form-control" name="drug_sell_price" id="drug_sell_price"
                value="{{ drug.drug_sell_price }}" required>
        </div>

        <!-- Purchase Price -->
        <div class="mb-3">
            <label for="drug_purchase_price" class="form-label">Purchase Price</label>
            <input type="number" step="0.01" class="form-control" name="drug_purchase_price" id="drug_purchase_price"
                value="{{ drug.drug_purchase_price }}" required>
        </div>

        <!-- Stock -->
        <div class="mb-3">
            <label for="drug_stock" class="form-label">Stock</label>
            <input type="number" class="form-control" name="drug_stock" id="drug_stock" value="{{ drug.drug_stock }}"
                required>
        </div>

        <button type="button" class="btn btn-primary" onclick="updateDrug()">
            Update
        </button>
        <button type="button" class="btn btn-secondary" onclick="cancel()">
            Cancel
        </button>
        <button type="button" class="btn btn-danger" onclick="deleteDrug('{{ drug.drug_id }}')">
            Delete
        </button>
    </form>
</div>

<script>
    function updateDrug() {
        document.getElementById("drug-form").submit();
    }
    // url_for use name of the function
    function cancel() {
        window.location.href = "{{ url_for('show_all_drugs') }}";
    }

    function deleteDrug(drug_id) {
        if (
            confirm("Do you really want to delete {{ drug.drug_name }}?")
        ) {
            fetch("/drugs_list/delete/" + encodeURIComponent(drug_id), {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
                if (response.ok) {
                    alert("Drug {{ drug.drug_name }} is deleted");
                    window.location.href = "{{ request.url_for('show_all_drugs') }}";
                } else {
                    alert("Error deleting")
                }
            }).catch(err => console.error(err));
        }
    }
</script>
{% endblock %}